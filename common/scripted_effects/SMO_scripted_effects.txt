init_selected_regions_indexes = {
	# Belarus
	set_variable = { global.selected_region_minskaya_oblast_index = 0 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 3 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }

	set_variable = { global.selected_region_vitebskaya_oblast_index = 1 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 2 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_grodnenskaya_oblast_index = 2 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 5 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_brestskaya_oblast_index = 3 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 75 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_gomelskaya_oblast_index = 4 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 6 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_mogilyovskaya_oblast_index = 5 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 4 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	

	# Ukraine / LDPR
	set_variable = { global.selected_region_volynskaya_oblast_index = 6 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 70 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_rovnenskaya_oblast_index = 7 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 69 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_zhitomirskaya_oblast_index = 8 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 45 }
	add_to_array = { global.selected_region_to_regions_ids = 159 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
		
	set_variable = { global.selected_region_kievskaya_oblast_index = 9 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 23 }
	add_to_array = { global.selected_region_to_regions_ids = 68 }
	add_to_array = { global.selected_region_to_regions_ids = 146 }
	add_to_array = { global.selected_region_to_regions_ids = 147 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_chernigovskaya_oblast_index = 10 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 26 }
	add_to_array = { global.selected_region_to_regions_ids = 148 }
	add_to_array = { global.selected_region_to_regions_ids = 149 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_sumskaya_oblast_index = 11 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 65 }
	add_to_array = { global.selected_region_to_regions_ids = 150 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_kharkovskaya_oblast_index = 12 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 44 }
	add_to_array = { global.selected_region_to_regions_ids = 121 }
	add_to_array = { global.selected_region_to_regions_ids = 122 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_luganskaya_oblast_index = 13 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 63 }
	add_to_array = { global.selected_region_to_regions_ids = 119 }
	add_to_array = { global.selected_region_to_regions_ids = 120 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_donetskaya_oblast_index = 14 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 31 }
	add_to_array = { global.selected_region_to_regions_ids = 116 }
	add_to_array = { global.selected_region_to_regions_ids = 117 }
	add_to_array = { global.selected_region_to_regions_ids = 118 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_zaporozhskaya_oblast_index = 15 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 57 }
	add_to_array = { global.selected_region_to_regions_ids = 58 }
	add_to_array = { global.selected_region_to_regions_ids = 106 }
	add_to_array = { global.selected_region_to_regions_ids = 107 }
	add_to_array = { global.selected_region_to_regions_ids = 108 }
	add_to_array = { global.selected_region_to_regions_ids = 109 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_khersonskaya_oblast_index = 16 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 27 }
	add_to_array = { global.selected_region_to_regions_ids = 56 }
	add_to_array = { global.selected_region_to_regions_ids = 110 }
	add_to_array = { global.selected_region_to_regions_ids = 111 }
	add_to_array = { global.selected_region_to_regions_ids = 112 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_nikolaevskaya_oblast_index = 17 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 24 }
	add_to_array = { global.selected_region_to_regions_ids = 155 }
	add_to_array = { global.selected_region_to_regions_ids = 156 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_odesskaya_oblast_index = 18 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 25 }
	add_to_array = { global.selected_region_to_regions_ids = 59 }
	add_to_array = { global.selected_region_to_regions_ids = 158 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_vinnitskaya_oblast_index = 19 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 46 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_chernovtskaya_oblast_index = 20 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 72 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_ivano_frankovskaya_oblast_index = 21 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 71 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_zakarpatskaya_oblast_index = 22 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 21 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_lvovskaya_oblast_index = 23 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 22 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_ternopolskaya_oblast_index = 24 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 74 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_khmelnitskaya_oblast_index = 25 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 73 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_cherkasskaya_oblast_index = 26 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 66 }
	add_to_array = { global.selected_region_to_regions_ids = 67 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_poltavskaya_oblast_index = 27 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 64 }
	add_to_array = { global.selected_region_to_regions_ids = 151 }
	add_to_array = { global.selected_region_to_regions_ids = 154 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_kirovogradskaya_oblast_index = 28 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 60 }
	add_to_array = { global.selected_region_to_regions_ids = 157 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_dniepropetrovskaya_oblast_index = 29 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 61 }
	add_to_array = { global.selected_region_to_regions_ids = 62 }
	add_to_array = { global.selected_region_to_regions_ids = 152 }
	add_to_array = { global.selected_region_to_regions_ids = 153 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	
	# Russia
	set_variable = { global.selected_region_kaliningradskaya_oblast_index = 30 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 8 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
			
	set_variable = { global.selected_region_smolenskaya_oblast_index = 31 }	
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 39 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_bryanskaya_oblast_index = 32 }	
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 77 }
	add_to_array = { global.selected_region_to_regions_ids = 128 }
	add_to_array = { global.selected_region_to_regions_ids = 129 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_kurskaya_oblast_index = 33 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 76 }
	add_to_array = { global.selected_region_to_regions_ids = 125 }
	add_to_array = { global.selected_region_to_regions_ids = 126 }
	add_to_array = { global.selected_region_to_regions_ids = 127 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_belgorodskaya_oblast_index = 34 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 37 }
	add_to_array = { global.selected_region_to_regions_ids = 123 }
	add_to_array = { global.selected_region_to_regions_ids = 124 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_voronezhskaya_oblast_index = 35 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 78 }
	add_to_array = { global.selected_region_to_regions_ids = 130 }
	add_to_array = { global.selected_region_to_regions_ids = 131 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_rostovskaya_oblast_index = 36 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 79 }
	add_to_array = { global.selected_region_to_regions_ids = 80 }
	add_to_array = { global.selected_region_to_regions_ids = 132 }
	add_to_array = { global.selected_region_to_regions_ids = 133 }
	add_to_array = { global.selected_region_to_regions_ids = 134 }
	add_to_array = { global.selected_region_to_regions_ids = 135 }
	add_to_array = { global.selected_region_to_regions_ids = 136 }
	add_to_array = { global.selected_region_to_regions_ids = 137 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_krasnodarskaya_oblast_index = 37 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 33 }
	add_to_array = { global.selected_region_to_regions_ids = 138 }
	add_to_array = { global.selected_region_to_regions_ids = 139 }
	add_to_array = { global.selected_region_to_regions_ids = 140 }
	add_to_array = { global.selected_region_to_regions_ids = 141 }
	add_to_array = { global.selected_region_to_regions_ids = 142 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_crimea_index = 38 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 28 }
	add_to_array = { global.selected_region_to_regions_ids = 113 }
	add_to_array = { global.selected_region_to_regions_ids = 114 }
	add_to_array = { global.selected_region_to_regions_ids = 115 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	


	# Lithuania
	set_variable = { global.selected_region_lithuania_index = 39 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 7 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	
	# Latvia
	set_variable = { global.selected_region_latvia_index = 40 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 1 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	

	# Poland
	set_variable = { global.selected_region_varminskaya_oblast_index = 41 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 9 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_podlyashskay_oblast_index = 42 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 9 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_lublinskaya_oblast_index = 43 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 11 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	
	set_variable = { global.selected_region_podkarpatskaya_oblast_index = 44 }
	add_to_array = { global.selected_region_to_regions_ids_start_index = global.selected_region_to_regions_ids^num }
	add_to_array = { global.selected_region_to_regions_ids = 11 }
	add_to_array = { global.selected_region_to_regions_ids_end_index = global.selected_region_to_regions_ids^num }
	

	# Info
	set_variable = { global.selected_region_indexes_count = 45 }

	BLR = {
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_gomelskaya_oblast_index }
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_brestskaya_oblast_index }
	}

	UKR = {
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_volynskaya_oblast_index }
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_rovnenskaya_oblast_index }
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_zhitomirskaya_oblast_index }
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_kievskaya_oblast_index }
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_chernigovskaya_oblast_index }
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_sumskaya_oblast_index }
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_kharkovskaya_oblast_index }
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_luganskaya_oblast_index }
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_donetskaya_oblast_index }
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_khersonskaya_oblast_index }
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_crimea_index }
	}
	
	RUS = {
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_kaliningradskaya_oblast_index }
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_bryanskaya_oblast_index }
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_kurskaya_oblast_index }
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_belgorodskaya_oblast_index }
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_voronezhskaya_oblast_index }
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_rostovskaya_oblast_index }
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_krasnodarskaya_oblast_index }
		add_to_array = { bz_manpower_owner_pool_indexes = global.selected_region_crimea_index }
	}
}

map_update_region_manpower = {
	#bz_init_constants = yes
	bz_recalculate_active_bz_provinces_count = yes
	meta_effect = {
		text = { 
			set_variable = { bz_region_manpower = bz_manpower_pool_[REGION_INDEX] } 
			set_variable = { bz_region_manpower_max_value = global.bz_manpower_pool_[REGION_INDEX]_max_value }

			if = { 
				limit = { is_in_array = { 
					array = bz_manpower_owner_pool_indexes
					value = selected_region
				}}
				set_variable = { bz_region_manpower_recommended = global.bz_manpower_pool_[REGION_INDEX]_min_value }
				multiply_variable = { bz_region_manpower_recommended = global.bz_region_manpower_recommended_factor }
				round_variable = bz_region_manpower_recommended
			}
			else = {
				set_variable = { bz_region_manpower_recommended = 0 }
			}
		}
		REGION_INDEX = "[?selected_region]"
	}
}

map_plan_update_tick = {
	if = {
		limit = { 
			check_variable = { map_plans_attack_start_days > 0 }
			check_variable = { map_plans_attack_start_days < global.num_days }
		}

		set_temp_variable = { temp_selected_region = selected_region }
		set_variable = { selected_region = map_plans_attack_region_index }
		country_event = map.1
		set_variable = { selected_region = temp_selected_region }

		set_temp_variable = { temp_selected_region_index = map_plans_attack_region_index }
		set_temp_variable = { temp_modifier_type = 2 }
		map_apply_modifier_action = yes

		set_variable = { map_plans_attack_start_days = 0 }
		set_variable = { map_plans_attack_region_index = 0 }
	}

	if = {
		limit = { 
			check_variable = { map_plans_defence_start_days > 0 } 
			check_variable = { map_plans_defence_start_days < global.num_days }
		}

		set_temp_variable = { temp_selected_region = selected_region }
		set_variable = { selected_region = map_plans_defence_region_index }
		country_event = map.2
		set_variable = { selected_region = temp_selected_region }

		set_temp_variable = { temp_selected_region_index = map_plans_defence_region_index }
		set_temp_variable = { temp_modifier_type = 3 }
		map_apply_modifier_action = yes
		

		set_variable = { map_plans_defence_start_days = 0 }
		set_variable = { map_plans_defence_region_index = 0 }
	}
}

# THIS scope is COUNTRY

map_plan_priority_direction_set = {
	if = {
		limit = { map_plan_is_priority_direction_available = yes }

		add_command_power = -100
				
		set_variable = { map_plan_priority_direction_cooldown = global.num_days }
		add_to_variable = { map_plan_priority_direction_cooldown = 90 } # время действия модификатора + его подготовка (см. ниже в map_apply_modifier_action)
		set_country_flag = {
			flag = map_plan_priority_direction_cooldown_flag
			days = 90
		}
		
		set_variable = { temp_selected_region_index = selected_region }
		set_temp_variable = { temp_modifier_type = 1 }
		map_apply_modifier_action = yes
	}
}

# THIS scope is COUNTRY
map_plan_attack_prepare = {	
	log = "[?map_plans_attack_region_index] [?map_plan_attack_cooldown] [?global.num_days]"
	if = {
		limit = { map_plan_is_attack_available = yes }

		set_variable = { map_plans_attack_start_days = global.num_days }
		add_to_variable = { map_plans_attack_start_days = 15 }
		
		set_variable = { map_plans_attack_region_index = selected_region }

		add_command_power = -100
		
		set_variable = { map_plan_attack_cooldown = global.num_days }
		add_to_variable = { map_plan_attack_cooldown = 45 } # время действия модификатора + его подготовка (см. ниже в map_apply_modifier_action)
		set_country_flag = {
			flag = map_plan_attack_cooldown_flag
			days = 45
		}
	}
}

# THIS scope is COUNTRY
map_plan_defence_prepare = {
	log = "[?map_plans_attack_region_index] [?map_plan_attack_cooldown] [?global.num_days]"
	if = {
		limit = { map_plan_is_defence_available = yes }

		set_variable = { map_plans_defence_start_days = global.num_days }
		add_to_variable = { map_plans_defence_start_days = 15 }
		
		set_variable = { map_plans_defence_region_index = selected_region }

		add_command_power = -60

		set_variable = { map_plan_defence_cooldown = global.num_days }
		add_to_variable = { map_plan_defence_cooldown = 75 } # время действия модификатора + его подготовка (см. ниже в map_apply_modifier_action)
		set_country_flag = {
			flag = map_plan_defence_cooldown_flag
			days = 75
		}
		
	}
}

# THIS scope is COUNTRY
map_plan_build_fortifications_prepare_set = {
	if = {
		limit = { map_plan_build_fortifications_available = yes }

		add_command_power = -50

		set_variable = { map_plan_build_fortifications_cooldown = global.num_days }
		add_to_variable = { map_plan_build_fortifications_cooldown = 45 }
		set_country_flag = {
			flag = map_plan_build_fortifications_cooldown_flag
			days = 45
		}

		set_variable = { temp_selected_region_index = selected_region }
		set_temp_variable = { temp_modifier_type = 4 }
		map_apply_modifier_action = yes
	}
}

# THIS scope is COUNTRY
# Must contain temp vars:
# 1. temp_selected_region_index
# 2. temp_modifier_type
map_apply_modifier_action = {
	for_loop_effect = { # Цикл по страт. регионам внутри региона карты
		start = global.selected_region_to_regions_ids_start_index^temp_selected_region_index
		end = global.selected_region_to_regions_ids_end_index^temp_selected_region_index
		value = temp_region_index

		set_temp_variable = { temp_region_id = global.selected_region_to_regions_ids^temp_region_index }

		for_loop_effect = { # Цикл по стейтам
			start = global.regions_to_states_ids_start_index^temp_region_id
			end = global.regions_to_states_ids_end_index^temp_region_id
			value = temp_state_index

			set_temp_variable = { temp_state_id = global.regions_to_states_ids^temp_state_index }

			var:temp_state_id = {
				if = {
					limit = { check_variable = { temp_modifier_type = 1 } } #Приоритетное направление 
					add_dynamic_modifier = {
						modifier = map_plan_priority_direction_modifier
						scope = ROOT
						days = 90
					}
				}
				else_if = {
					limit = { check_variable = { temp_modifier_type = 2 } } #План атаки 
					add_dynamic_modifier = {
						modifier = map_plan_attack_modifier
						scope = ROOT
						days = 30
					}
				}
				else_if = {
					limit = { check_variable = { temp_modifier_type = 3 } } #План защиты 
					add_dynamic_modifier = {
						modifier = map_plan_defence_modifier
						scope = ROOT
						days = 60
					}
				}
				else_if = {
					limit = { check_variable = { temp_modifier_type = 4 } } #Постройка укрепов
					add_dynamic_modifier = {
						modifier = map_plan_build_fortifications_modifier
						scope = ROOT
						days = 60
					}
				}
			}
		}
	}
}

# THIS scope is COUNTRY
map_update_regions_status = {
	if = {
		limit = { NOT = { check_variable = { global.selected_region_indexes_count = selected_regions_status^num } } }
		resize_array = { selected_regions_status = global.selected_region_indexes_count }
	}

	for_loop_effect = { # Цикл по регионам гуи карты СВО
		start = 0
		end = global.selected_region_indexes_count
		value = temp_selected_region_index

		set_temp_variable = { temp_friend_flag = 0 }
		set_temp_variable = { temp_enemy_flag = 0 }

		set_temp_variable = { temp_break_flag = 0 }

		for_loop_effect = { # Цикл по страт. регионам внутри региона карты
			start = global.selected_region_to_regions_ids_start_index^temp_selected_region_index
			end = global.selected_region_to_regions_ids_end_index^temp_selected_region_index
			value = temp_region_index
			break = temp_break_flag

			set_temp_variable = { temp_region_id = global.selected_region_to_regions_ids^temp_region_index }

			for_loop_effect = { # Цикл по стейтам
				start = global.regions_to_states_ids_start_index^temp_region_id
				end = global.regions_to_states_ids_end_index^temp_region_id
				value = temp_state_index
				break = temp_break_flag

				set_temp_variable = { temp_state_id = global.regions_to_states_ids^temp_state_index }

				set_temp_variable = { temp_state_controller = 0 }
				var:temp_state_id = { controller = { add_to_temp_variable = { temp_state_controller = THIS } }}

				if = { # Если стейт полностью под контроллем определённой страны
					limit = { var:temp_state_controller = { has_full_control_of_state = var:temp_state_id }}

					if = { # Если владелец воюет ROOT
						limit = { var:temp_state_controller = { has_war_with = ROOT } }
						add_to_temp_variable = { temp_enemy_flag = 1 }
					}
					else_if = { # Если владелец ROOT или его союзник
						limit = { 
							var:temp_state_controller = { 
								OR = { 
									original_tag = ROOT 
									AND = {
										has_war = yes
										is_ally_with = ROOT
									}
								} 
							} 
						}
						add_to_temp_variable = { temp_friend_flag = 1 }
					}

					if = {
						limit = {
							check_variable = { temp_enemy_flag = temp_friend_flag }
							check_variable = { temp_enemy_flag > 0 }
						}

						add_to_temp_variable = { temp_break_flag = 1 }
					}
				}
				else = {
					add_to_temp_variable = { temp_enemy_flag = 1 }
					add_to_temp_variable = { temp_friend_flag = 1 }

					add_to_temp_variable = { temp_break_flag = 1 }
				}
			}
		}

		# 0 - нейтральный
		# 1 - вражеский
		# 2 - дружественный
		# 3 - бои

		if = {
			limit = {
				check_variable = { temp_enemy_flag > 0 }
				check_variable = { temp_friend_flag = 0 }
			}
			set_variable = { selected_regions_status^temp_selected_region_index = 1 }
		}
		else_if = {
			limit = {
				check_variable = { temp_enemy_flag = 0 }
				check_variable = { temp_friend_flag > 0 }
			}
			set_variable = { selected_regions_status^temp_selected_region_index = 2 }
		}
		else_if = {
			limit = {
				check_variable = { temp_enemy_flag > 0 }
				check_variable = { temp_friend_flag > 0 }
			}
			set_variable = { selected_regions_status^temp_selected_region_index = 3 }
		}
		else = {
			set_variable = { selected_regions_status^temp_selected_region_index = 0 }
		}
	}
}

map_region_init = {
	set_variable = { SMO_region_x = 10 }
	set_variable = { SMO_region_y = 50 }
	map_update_region_manpower = yes
	map_clear_arrays = yes
	SMO_state_check = yes
}

map_clear_arrays = {	
	clear_array = map_cities_array
	
	clear_array = SMO_city_x
	clear_array = SMO_city_y

	clear_array = map_big_cities_array
	
	clear_array = SMO_big_city_x
	clear_array = SMO_big_city_y
}

map_regions_init_belgorodskaya_oblast = {
	set_variable = { selected_region = global.selected_region_belgorodskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_brestskaya_oblast = {
	set_variable = { selected_region = global.selected_region_brestskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_bryanskaya_oblast = {
	set_variable = { selected_region = global.selected_region_bryanskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_cherkasskaya_oblast = {
	set_variable = { selected_region = global.selected_region_cherkasskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_chernigovskaya_oblast = {
	set_variable = { selected_region = global.selected_region_chernigovskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_chernovtskaya_oblast = {
	set_variable = { selected_region = global.selected_region_chernovtskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_crimea = {
	set_variable = { selected_region = global.selected_region_crimea_index }
	map_region_init = yes	
}
map_regions_init_dniepropetrovskaya_oblast = {
	set_variable = { selected_region = global.selected_region_dniepropetrovskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_donetskaya_oblast = {
	set_variable = { selected_region = global.selected_region_donetskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_gomelskaya_oblast = {
	set_variable = { selected_region = global.selected_region_gomelskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_ivano_frankovskaya_oblast = {
	set_variable = { selected_region = global.selected_region_ivano_frankovskaya_oblast_index }
	map_region_init = yes		
}
map_regions_init_zakarpatskaya_oblast = {
	set_variable = { selected_region = global.selected_region_zakarpatskaya_oblast_index }
	map_region_init = yes		
}
map_regions_init_kharkovskaya_oblast = {
	set_variable = { selected_region = global.selected_region_kharkovskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_khersonskaya_oblast = {
	set_variable = { selected_region = global.selected_region_khersonskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_khmelnitskaya_oblast = {
	set_variable = { selected_region = global.selected_region_khmelnitskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_kievskaya_oblast = {
	set_variable = { selected_region = global.selected_region_kievskaya_oblast_index }
	map_region_init = yes		
}
map_regions_init_kirovogradskaya_oblast = {
	set_variable = { selected_region = global.selected_region_kirovogradskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_krasnodarskaya_oblast = {
	set_variable = { selected_region = global.selected_region_krasnodarskaya_oblast_index }
	map_region_init = yes		
}
map_regions_init_kurskaya_oblast = {
	set_variable = { selected_region = global.selected_region_kurskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_luganskaya_oblast = {
	set_variable = { selected_region = global.selected_region_luganskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_volynskaya_oblast = {
	set_variable = { selected_region = global.selected_region_volynskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_lvovskaya_oblast = {
	set_variable = { selected_region = global.selected_region_lvovskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_nikolaevskaya_oblast = {
	set_variable = { selected_region = global.selected_region_nikolaevskaya_oblast_index }
	map_region_init = yes		
}
map_regions_init_odesskaya_oblast = {
	set_variable = { selected_region = global.selected_region_odesskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_poltavskaya_oblast = {
	set_variable = { selected_region = global.selected_region_poltavskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_rostovskaya_oblast = {
	set_variable = { selected_region = global.selected_region_rostovskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_sumskaya_oblast = {
	set_variable = { selected_region = global.selected_region_sumskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_ternopolskaya_oblast = {
	set_variable = { selected_region = global.selected_region_ternopolskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_vinnitskaya_oblast = {
	set_variable = { selected_region = global.selected_region_vinnitskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_voronezhskaya_oblast = {
	set_variable = { selected_region = global.selected_region_voronezhskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_zaporozhskaya_oblast = {
	set_variable = { selected_region = global.selected_region_zaporozhskaya_oblast_index }
	map_region_init = yes	
}
map_regions_init_zhitomirskaya_oblast = {
	set_variable = { selected_region = global.selected_region_zhitomirskaya_oblast_index }
	map_region_init = yes		
}
map_regions_init_rovnenskaya_oblast = {
	set_variable = { selected_region = global.selected_region_rovnenskaya_oblast_index }
	map_region_init = yes	
}

SMO_state_check = {
	every_state = {
		limit = { OR = { 
			is_core_of = UKR 
			is_claimed_by = UKR 
		} }

		if = {
			limit = {
				OR = {
					is_controlled_by = RUS
					is_controlled_by = UKR
					is_controlled_by = DPR
					is_controlled_by = LPR
				}
				NOT = {
					OR = {
						is_fully_controlled_by = RUS
						is_fully_controlled_by = UKR
						is_fully_controlled_by = DPR
						is_fully_controlled_by = LPR
					}
				}
			}
			set_variable = { city_condition = 4 }
			else_if = {
				limit = {
					OR = {
						is_fully_controlled_by = RUS
						is_fully_controlled_by = DPR
						is_fully_controlled_by = LPR
					}
				}
				set_variable = { city_condition = 3 }
			}
			else_if = {
				limit = { is_fully_controlled_by = UKR }
				set_variable = { city_condition = 2 }
			}
			else = {
				set_variable = { city_condition = 1 }
			}
		}
	}
}