init_map_africa_global_data = {
	set_variable = { global.map_africa_sahel_region_index = 0 }
	set_variable = { global.map_africa_center_region_index = 1 }
	set_variable = { global.map_africa_middle_east_region_index = 2 }
	set_variable = { global.map_africa_madagascar_region_index = 3 }
	set_variable = { global.map_africa_zimbabwe_region_index = 4 }
	set_variable = { global.map_africa_dr_congo_region_index = 5 }
	set_variable = { global.map_africa_venesuella_region_index = 6 }
	set_variable = { global.map_africa_libya_region_index = 7 }
	set_variable = { global.map_africa_sudan_region_index = 8 }
	set_variable = { global.map_africa_gvinea_region_index = 9 }
	
	# Info (How much there are regions)
	set_variable = { global.map_africa_region_indexes_count = 10 }

	WGN = { 
		init_map_africa_country_data = yes

		# Active regions
		set_variable = { map_africa_enabled_region_indexes^map_africa_center_region_index = 1 }
		set_variable = { map_africa_enabled_region_indexes^map_africa_middle_east_region_index = 2 }
		set_variable = { map_africa_enabled_region_indexes^map_africa_madagascar_region_index = 3 }
		set_variable = { map_africa_enabled_region_indexes^map_africa_zimbabwe_region_index = 4 }
		set_variable = { map_africa_enabled_region_indexes^map_africa_dr_congo_region_index = 5 }
		set_variable = { map_africa_enabled_region_indexes^map_africa_venesuella_region_index = 6 }
		set_variable = { map_africa_enabled_region_indexes^map_africa_libya_region_index = 7 }
		set_variable = { map_africa_enabled_region_indexes^map_africa_sudan_region_index = 8 }
		set_variable = { map_africa_enabled_region_indexes^map_africa_gvinea_region_index = 9 }

		# Setup initial human resources
		set_variable = { map_africa_political_strategists_pool_free = 0 }
		set_variable = { map_africa_military_instructors_pool_free = 0 }
		set_variable = { map_africa_military_personnel_pool_free = 0 }

		set_variable = { map_africa_military_personnel_pool_indexes^global.map_africa_middle_east_region_index = 2025 }
		set_variable = { map_africa_political_strategists_pool_indexes^global.map_africa_middle_east_region_index = 15 }
		set_variable = { map_africa_military_instructors_pool_indexes^global.map_africa_middle_east_region_index = 250 }
		
		set_variable = { map_africa_military_personnel_pool_indexes^global.map_africa_center_region_index = 1650 }
		set_variable = { map_africa_political_strategists_pool_indexes^global.map_africa_center_region_index = 20 }
		set_variable = { map_africa_military_instructors_pool_indexes^global.map_africa_center_region_index = 325 }
		
		set_variable = { map_africa_military_personnel_pool_indexes^global.map_africa_madagascar_region_index = 20 }
		set_variable = { map_africa_political_strategists_pool_indexes^global.map_africa_madagascar_region_index = 7 }
		set_variable = { map_africa_military_instructors_pool_indexes^global.map_africa_madagascar_region_index = 7 }
		
		set_variable = { map_africa_military_personnel_pool_indexes^global.map_africa_zimbabwe_region_index = 15 }
		set_variable = { map_africa_political_strategists_pool_indexes^global.map_africa_zimbabwe_region_index = 5 }
		set_variable = { map_africa_military_instructors_pool_indexes^global.map_africa_zimbabwe_region_index = 12 }
		
		set_variable = { map_africa_military_personnel_pool_indexes^global.map_africa_dr_congo_region_index = 50 }
		set_variable = { map_africa_political_strategists_pool_indexes^global.map_africa_dr_congo_region_index = 5 }
		set_variable = { map_africa_military_instructors_pool_indexes^global.map_africa_dr_congo_region_index = 10 }
		
		set_variable = { map_africa_military_personnel_pool_indexes^global.map_africa_venesuella_region_index = 60 }
		set_variable = { map_africa_political_strategists_pool_indexes^global.map_africa_venesuella_region_index = 7 }
		set_variable = { map_africa_military_instructors_pool_indexes^global.map_africa_venesuella_region_index = 15 }
		
		set_variable = { map_africa_military_personnel_pool_indexes^global.map_africa_libya_region_index = 915 }
		set_variable = { map_africa_political_strategists_pool_indexes^global.map_africa_libya_region_index = 12 }
		set_variable = { map_africa_military_instructors_pool_indexes^global.map_africa_libya_region_index = 150 }
		
		set_variable = { map_africa_military_personnel_pool_indexes^global.map_africa_sudan_region_index = 515 }
		set_variable = { map_africa_political_strategists_pool_indexes^global.map_africa_sudan_region_index = 15 }
		set_variable = { map_africa_military_instructors_pool_indexes^global.map_africa_sudan_region_index = 120 }
		
		set_variable = { map_africa_military_personnel_pool_indexes^global.map_africa_gvinea_region_index = 10 }
		set_variable = { map_africa_political_strategists_pool_indexes^global.map_africa_gvinea_region_index = 5 }
		set_variable = { map_africa_military_instructors_pool_indexes^global.map_africa_gvinea_region_index = 5 }
	}
}

africa_manpower_global_data = {
	set_variable = { WGN_africa_manpower_var = 0 }
	add_to_variable = { WGN_africa_manpower_var = map_africa_military_personnel_pool_indexes^global.map_africa_center_region_index }
	add_to_variable = { WGN_africa_manpower_var = map_africa_military_personnel_pool_indexes^global.map_africa_sahel_region_index }
	add_to_variable = { WGN_africa_manpower_var = map_africa_military_personnel_pool_indexes^global.map_africa_middle_east_region_index }
	add_to_variable = { WGN_africa_manpower_var = map_africa_military_personnel_pool_indexes^global.map_africa_madagascar_region_index }
	add_to_variable = { WGN_africa_manpower_var = map_africa_military_personnel_pool_indexes^global.map_africa_zimbabwe_region_index }
	add_to_variable = { WGN_africa_manpower_var = map_africa_military_personnel_pool_indexes^global.map_africa_dr_congo_region_index }
	add_to_variable = { WGN_africa_manpower_var = map_africa_military_personnel_pool_indexes^global.map_africa_venesuella_region_index }
	add_to_variable = { WGN_africa_manpower_var = map_africa_military_personnel_pool_indexes^global.map_africa_libya_region_index }
	add_to_variable = { WGN_africa_manpower_var = map_africa_military_personnel_pool_indexes^global.map_africa_sudan_region_index }
	add_to_variable = { WGN_africa_manpower_var = map_africa_military_personnel_pool_indexes^global.map_africa_gvinea_region_index }
}

init_map_africa_country_data = {
	resize_array = { map_africa_enabled_region_indexes = global.map_africa_region_indexes_count }
	resize_array = { map_africa_political_strategists_pool_indexes = global.map_africa_region_indexes_count }
	resize_array = { map_africa_military_instructors_pool_indexes = global.map_africa_region_indexes_count }
	resize_array = { map_africa_military_personnel_pool_indexes = global.map_africa_region_indexes_count }
}




map_africa_tick_ai_regions_manpower_pools = {
	every_country = {
		limit = { has_country_flag = map_africa }

		if = {
			limit = { is_ai = yes }
			map_africa_tick_ai_country_regions_manpower_pools = yes
		}
		else_if = {
			limit = { NOT = { has_country_flag = map_africa_active_manpower_ai_disable } }
			map_africa_tick_player_country_regions_manpower_pools = yes
		}

		if = {
			limit = { has_country_flag = WGN_AFRICA_WINDOW_OPEN }
			map_africa_update_region_manpower = yes
		}

		if = {
			limit = { NOT = { is_ai = yes }}
			map_africa_calculate_sum_active_manpower = yes
		}
	}
}

# THIS scope is AI COUNTRY
map_africa_tick_ai_country_regions_manpower_pools = {
	for_loop_effect = { # Pools indexes
		start = 0
		end = global.selected_region_indexes_count
		value = pointer

		meta_effect = {
			text = { set_variable = { bz_manpower_pool_[REGION_INDEX] = 0 } }
			REGION_INDEX = "[?pointer]"
		}
	}
	
	for_each_loop = {
		array = bz_manpower_owner_pool_indexes
		value = pointer

		meta_effect = {
			text = { 
				set_temp_variable = { temp_bz_ai_manpower = global.bz_manpower_pool_[REGION_INDEX]_min_value }
				multiply_temp_variable = { temp_bz_ai_manpower = global.bz_manpower_pools_ai_manpower_factor }
				set_variable = { bz_manpower_pool_[REGION_INDEX] = temp_bz_ai_manpower }
			}
			REGION_INDEX = "[?pointer]"
		}
	}
}

# THIS scope is PLAYER COUNTRY
map_africa_tick_player_country_regions_manpower_pools = {
	for_loop_effect = { # Pools indexes
		start = 0
		end = global.selected_region_indexes_count
		value = pointer

		if = { # Если это неправильный регион
			limit = { NOT = { is_in_array = {
				array = bz_manpower_owner_pool_indexes
				value = pointer
			}}}

			meta_effect = {
				text = { 
					# То возвращаем менпавер из региона в пулл страны
					set_variable = { temp_delta_manpower = bz_manpower_pool_[REGION_INDEX] }
					add_manpower = temp_delta_manpower
					set_variable = { bz_manpower_pool_[REGION_INDEX] = 0 } 
				}
				REGION_INDEX = "[?pointer]"
			}
		}
	}
	
	for_each_loop = {
		array = bz_manpower_owner_pool_indexes
		value = pointer

		meta_effect = {
			text = { 
				# Получаем кол-во менпавера в регионе
				set_temp_variable = { temp_bz_current_manpower = bz_manpower_pool_[REGION_INDEX] }

				# Вычисляем рекомендуемое требование
				set_temp_variable = { temp_bz_ai_manpower = global.bz_manpower_pool_[REGION_INDEX]_min_value }
				multiply_temp_variable = { temp_bz_ai_manpower = global.bz_manpower_pools_ai_manpower_factor }

				# Получаем изменение менпавера в регионе
				set_temp_variable = { temp_bz_delta_manpower = temp_bz_ai_manpower }
				subtract_from_temp_variable = { temp_bz_delta_manpower = temp_bz_current_manpower }

				if = { # Если менпавер забирается из региона в пулл менпавера страны
					limit = { check_variable = { temp_bz_delta_manpower < 0 }}

					# Уменьшаем менпавер в регионе на нужное число
					add_to_variable = { bz_manpower_pool_[REGION_INDEX] = temp_bz_delta_manpower }

					# Возвращаем менпавер в пулл менпавера
					multiply_temp_variable = { temp_bz_delta_manpower = -1 }
					add_manpower = temp_bz_delta_manpower
				}
				else = { # Иначе менпавер выдаётся в регион из пулла менпавера страны
					# Органичиваем число менпавера, чтобы не создавать его из воздуха
					multiply_temp_variable = { temp_bz_delta_manpower = 0.001}
					clamp_temp_variable = {
						var = temp_bz_delta_manpower
						min = 0
						max = manpower_k
					}

					# Добавляем менпавер в регион
					multiply_temp_variable = { temp_bz_delta_manpower = 1000 }
					add_to_variable = { bz_manpower_pool_[REGION_INDEX] = temp_bz_delta_manpower }

					# Забираем менпавер и пулла страны
					multiply_temp_variable = { temp_bz_delta_manpower = -1 }
					add_manpower = temp_bz_delta_manpower
				}				
			}
			REGION_INDEX = "[?pointer]"
		}
	}
}

map_africa_update_region_manpower = {
	#bz_init_constants = yes
	bz_recalculate_active_bz_provinces_count = yes
	meta_effect = {
		text = { 
			set_variable = { bz_region_manpower = bz_manpower_pool_[REGION_INDEX] } 
			set_variable = { bz_region_manpower_max_value = global.bz_manpower_pool_[REGION_INDEX]_max_value }

			if = { 
				limit = { is_in_array = { 
					array = bz_manpower_owner_pool_indexes
					value = selected_region
				}}
				set_variable = { bz_region_manpower_recommended = global.bz_manpower_pool_[REGION_INDEX]_min_value }
				multiply_variable = { bz_region_manpower_recommended = global.bz_region_manpower_recommended_factor }
				round_variable = bz_region_manpower_recommended
			}
			else = {
				set_variable = { bz_region_manpower_recommended = 0 }
			}
		}
		REGION_INDEX = "[?selected_region]"
	}
}

map_africa_calculate_sum_active_manpower = {
	set_variable = { bz_sum_active_manpower = 0 }
	for_loop_effect = { # Pools indexes
		start = 0
		end = global.selected_region_indexes_count
		value = pointer

		meta_effect = {
			text = { add_to_variable = { bz_sum_active_manpower = bz_manpower_pool_[REGION_INDEX] } }
			REGION_INDEX = "[?pointer]"
		}
	}
}